{% extends 'main/base.html' %}


{% block style %}
    {% load static %}
    <link rel="stylesheet" href=" {%  static 'main/css/main.css'%}">
{% endblock %}

{% block content %}
    <div class="List" id="all">
        <h1> </h1>
            {% for el in course%}
                <div class="card block" id="{{ el.id }}" {% comment %}onclick="window.location.href = '{% url 'course' el.pk %}'"{% endcomment %}><div class="author">
                    {% if user.profile.profile_pic %}
                      <img class="courseAuthorAvatarProfile" src="{{el.author.user.profile.profile_pic.url}}">
                    {% else %}
                      <img class="courseAuthorAvatarProfile" src="{% static 'main/img/user96.png' %}"><br><br>
                    {% endif %}
                    <div id="authorname">
                        {{ el.author.user.profile.name }} {{ el.author.user.profile.surname }}
                    </div>
                    <div class="date"> - {{ el.date }}</div>
                </div>
                <div class="lable">
                    <div class="text">
                        <div class="title">{{ el.title }}</div>
                    </div>
                    <div class="categor">
                        <div class="pointBtn" id="l{{ el.category.pk }}"></div>
                        {{ el.category }}
                    </div>
                </div>
                    <div class="desk">{{el.description|truncatewords:50}}</div>

                <div class="tags"></br>
                    {% for tag in tags %}
                        <div>
                            {{ tag.tag }}
                        </div>
                    {% endfor %}
                </div>

                <div class="stat">
                    <img  src="https://img.icons8.com/material-rounded/24/000000/conference-background-selected.png"/>
                    <div class="usercount">{% for c in count_users %}{% if c.course_id == el.pk %}{{ c.total }}{% endif %}{% endfor %}</div>
                    {% if user_has_course%}
                        <div class="userhascourse" onclick="window.location.href = '{% url 'unsub_course' el.pk  %}'">ОТПИСАТЬСЯ</div>
                    {% else %}
                        <div class="go" onclick="window.location.href = '{% url 'sub_course' el.pk  %}'">ЗАПИСАТЬСЯ</div>
                    {% endif %}
                </div>

                {% if user == el.author.user %}
                    <div class = "courseToolbar">
                        <button class = "toolBtn" id="edit" onclick="window.location.href = '{% url 'edit_course' el.pk  %}'">
                            <img class="courseAuthorAvatar" src="{%  static 'main/img/pen.png' %}">
                        </button>
                        <button class = "toolBtn" id="coursedelete" onclick="toggle(hidden_content_{{ el.pk }})">
                            <img class="courseAuthorAvatar" src="{%  static 'main/img/delete.png' %}">
                        </button>
                    </div>
                {% elif user.is_superuser %}
                    <div class = "courseToolbar">
                        <button class = "toolBtn" id="edit" onclick="window.location.href = '{% url 'edit_course' el.pk  %}'">
                            <img class="courseAuthorAvatar" src="{%  static 'main/img/pen.png' %}">
                        </button>
                        <button class = "toolBtn" id="coursedelete" onclick="toggle(hidden_content_{{ el.pk }})">
                            <img class="courseAuthorAvatar" src="{%  static 'main/img/delete.png' %}">
                        </button>
                    </div>
                {% elif el.pk == 23 %}
                    <div class = "courseToolbar">
                        <button class = "toolBtn" id="edit" onclick="window.location.href = '{% url 'edit_course' el.pk  %}'">
                            <img class="courseAuthorAvatar" src="{%  static 'main/img/pen.png' %}">
                        </button>
                        <button class = "toolBtn" id="coursedelete" onclick="toggle(hidden_content_{{ el.pk }})">
                            <img class="courseAuthorAvatar" src="{%  static 'main/img/delete.png' %}">
                        </button>
                    </div>
                {% endif %}

            </div>
            <section class="application" id="hidden_content_{{ el.pk }}" style="display:none;">
                <div class="containerAlert">
                <h2>Удаление курса!</h2>
                <p>Вы уверены, что хотите удалить курс? </p>
                    <div class="argueBtn">
                      <button id="not" onclick="toggle(hidden_content_{{ el.pk }})">Нет</button>
                      <button id="yes" onclick="deleteCourse({{el.pk}}); toggle(hidden_content_{{ el.pk }})">Да</button>
                  </div>
              </div>
            </section>

            <script>
                function toggle(el) {
                  el.style.display = (el.style.display == 'none') ? '' : 'none';
                }

                function deleteCourse(courseId){
                    let deleteUrl = '/main/course/'+ courseId +'/delete'
                    fetch(deleteUrl).then(
                        response => {
                            return response.text();
                        }
                    ).then(
                        text => {
                            let json = JSON.parse(text);
                            for (element of json){
                                let deletedCourse = document.getElementById(element.pk);
                                deletedCourse.remove()
                            }
                            window.location.href = '/main';
                        }
                    );
                }
            </script>
            {% endfor %}
        </div>
        </div>

{% endblock %}

